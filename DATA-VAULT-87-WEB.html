<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DATA-BOY Terminal</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap');

:root {
    --crt-rotate-x: 0deg;
    --crt-rotate-y: 0deg;
    --crt-scale: 1.0;
    --scanline-opacity: 0.07;
    --glow-strength: 6px;
    --font-size: 15px;
    --main-color: #00ff66;
    --main-dim: #00aa44;
    --border-color: #00ff6644;
    --scanline-color: 0, 255, 102;
    --flicker-speed: 0.15s;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: #0a0a0a;
    color: var(--main-color);
    font-family: 'Share Tech Mono', 'Courier New', monospace;
    font-size: var(--font-size);
    height: 100vh;
    overflow: hidden;
    perspective: 1000px;
    user-select: none;
}

/* ─── DEEP BACKGROUND ─── */
#bg-layer {
    position: fixed; inset: 0;
    background:
        radial-gradient(ellipse 80% 50% at 50% 100%, rgba(0,255,102,0.04) 0%, transparent 70%),
        radial-gradient(ellipse 60% 40% at 20% 80%, rgba(0,180,80,0.03) 0%, transparent 60%),
        #050808;
    z-index: 0;
}

/* ─── PARTICLE CANVAS ─── */
#particle-canvas {
    position: fixed; inset: 0;
    z-index: 1;
    pointer-events: none;
    opacity: 0.35;
}

/* ─── CRT SCANLINES ─── */
#scanlines {
    position: fixed; inset: 0;
    pointer-events: none;
    background: repeating-linear-gradient(
        to bottom,
        rgba(var(--scanline-color), var(--scanline-opacity)) 0px,
        rgba(var(--scanline-color), var(--scanline-opacity)) 1px,
        transparent 1px,
        transparent 3px
    );
    z-index: 900;
    animation: flicker var(--flicker-speed) infinite alternate;
}
@keyframes flicker { from { opacity: 1; } to { opacity: 0.92; } }

/* ─── CRT VIGNETTE ─── */
#vignette {
    position: fixed; inset: 0;
    pointer-events: none;
    box-shadow: inset 0 0 140px 40px rgba(0,0,0,0.7);
    z-index: 901;
}

/* ─── GLITCH OVERLAY ─── */
#glitch-overlay {
    position: fixed; inset: 0;
    pointer-events: none;
    z-index: 902;
    opacity: 0;
    background: linear-gradient(transparent 30%, rgba(0,255,102,0.03) 50%, transparent 70%);
}
body.glitch-active #glitch-overlay { animation: glitchSlide 0.15s steps(2) forwards; }
@keyframes glitchSlide {
    0%   { opacity: 1; transform: translateX(-4px) skewX(1deg); }
    33%  { opacity: 0.8; transform: translateX(6px) skewX(-2deg); }
    66%  { opacity: 1; transform: translateX(-2px) skewX(0.5deg); }
    100% { opacity: 0; transform: translateX(0); }
}

/* ─── HEADER BAR ─── */
#header {
    position: fixed; top: 0; left: 0; right: 0;
    height: 38px;
    background: rgba(5,10,8,0.92);
    border-bottom: 1px solid var(--border-color);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 16px;
    z-index: 800;
    backdrop-filter: blur(2px);
}
#header-left {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px; font-weight: 700;
    letter-spacing: 3px;
    color: var(--main-color);
    text-shadow: 0 0 var(--glow-strength) var(--main-color);
}
#header-right {
    display: flex; gap: 18px; align-items: center;
    font-size: 11px; color: var(--main-dim);
    letter-spacing: 1px;
}
#header-right span { cursor: pointer; transition: color 0.2s; }
#header-right span:hover { color: var(--main-color); text-shadow: 0 0 6px var(--main-color); }
#status-light {
    width: 8px; height: 8px; border-radius: 50%;
    background: var(--main-color);
    box-shadow: 0 0 6px var(--main-color);
    animation: pulse 2s ease-in-out infinite;
}
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

/* ─── MAIN SCREEN ─── */
#screen-wrap {
    position: absolute;
    top: 38px; left: 0; right: 0; bottom: 68px;
    overflow-y: auto;
    overflow-x: hidden;
    z-index: 2;
    padding: 18px 22px;
    scrollbar-width: thin;
    scrollbar-color: var(--border-color) transparent;
    transform-origin: center center;
    transform: perspective(900px)
               rotateX(var(--crt-rotate-x))
               rotateY(var(--crt-rotate-y))
               scale(var(--crt-scale));
}
#screen-wrap::-webkit-scrollbar { width: 6px; }
#screen-wrap::-webkit-scrollbar-track { background: transparent; }
#screen-wrap::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }

#screen { min-height: 100%; }

.line {
    color: var(--main-color);
    text-shadow: 0 0 var(--glow-strength) var(--main-color);
    line-height: 1.55;
    white-space: pre-wrap;
    word-break: break-word;
    animation: lineIn 0.25s ease-out;
}
@keyframes lineIn { from { opacity:0; transform: translateX(-8px); } to { opacity:1; transform:translateX(0); } }

.line.dim  { color: var(--main-dim); text-shadow: 0 0 3px var(--main-dim); }
.line.warn { color: #ff6633; text-shadow: 0 0 6px #ff6633; }
.line.err  { color: #cc2200; text-shadow: 0 0 8px #cc2200; }
.line.head {
    color: var(--main-color);
    font-family: 'Orbitron', sans-serif;
    font-size: 12px; font-weight: 700;
    letter-spacing: 2px;
    margin-top: 6px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 3px;
}
.line.sep { color: var(--main-dim); opacity: 0.5; }

/* ─── INPUT BAR ─── */
#input-line {
    position: fixed; bottom: 0; left: 0; right: 0;
    height: 68px;
    background: rgba(5,10,8,0.95);
    border-top: 1px solid var(--border-color);
    display: flex; align-items: center;
    padding: 0 16px; gap: 8px;
    z-index: 800;
    backdrop-filter: blur(3px);
}
#prompt {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px; font-weight: 700;
    color: var(--main-color);
    text-shadow: 0 0 var(--glow-strength) var(--main-color);
    letter-spacing: 1px;
    white-space: nowrap;
    min-width: 130px;
}
#command {
    flex: 1;
    background: transparent;
    border: none; outline: none;
    color: var(--main-color);
    font-family: inherit;
    font-size: var(--font-size);
    text-shadow: 0 0 var(--glow-strength) var(--main-color);
    caret-color: var(--main-color);
    padding: 4px 0;
}
#command::placeholder { color: var(--main-dim); opacity: 0.4; }
#cursor {
    width: 9px; height: 18px;
    background: var(--main-color);
    box-shadow: 0 0 8px var(--main-color);
    animation: blink 0.8s steps(1) infinite;
    flex-shrink: 0;
}
@keyframes blink { 50% { opacity: 0; } }

/* ─── SETTINGS PANEL ─── */
#settings-toggle {
    position: fixed; top: 8px; right: 12px;
    z-index: 810;
    background: transparent;
    color: var(--main-dim);
    border: 1px solid var(--border-color);
    border-radius: 3px;
    padding: 3px 10px;
    cursor: pointer;
    font-family: 'Orbitron', sans-serif;
    font-size: 9px; letter-spacing: 2px;
    transition: all 0.2s;
}
#settings-toggle:hover { color: var(--main-color); border-color: var(--main-color); box-shadow: 0 0 8px var(--border-color); }

#settings-panel {
    position: fixed; top: 42px; right: 10px;
    width: 240px;
    background: rgba(5,12,10,0.96);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 14px;
    z-index: 805;
    color: var(--main-color);
    font-size: 11px;
    line-height: 1.8;
    backdrop-filter: blur(4px);
    box-shadow: 0 4px 30px rgba(0,0,0,0.5), inset 0 1px 0 var(--border-color);
    transition: opacity 0.2s, transform 0.2s;
}
#settings-panel.hidden { opacity: 0; pointer-events: none; transform: translateY(-6px); }
#settings-panel h3 {
    font-family: 'Orbitron', sans-serif;
    font-size: 10px; letter-spacing: 2px; margin-bottom: 10px;
    color: var(--main-color); text-shadow: 0 0 4px var(--main-color);
}
#settings-panel label { display: block; margin-bottom: 4px; color: var(--main-dim); }
#settings-panel input[type="range"] {
    -webkit-appearance: none; width: 100%; height: 3px;
    background: var(--border-color); border-radius: 2px; outline: none;
}
#settings-panel input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 12px; height: 12px;
    background: var(--main-color); border-radius: 50%; cursor: pointer;
    box-shadow: 0 0 6px var(--main-color);
}
#settings-panel select, #settings-panel input[type="text"], #settings-panel input[type="color"] {
    background: rgba(0,0,0,0.6); border: 1px solid var(--border-color);
    color: var(--main-color); border-radius: 3px; padding: 2px 6px;
    font-family: inherit; font-size: 11px; width: 100%;
}
#settings-panel input[type="color"] { height: 24px; padding: 1px; cursor: pointer; }
#settings-panel .checkbox-row { display: flex; align-items: center; gap: 8px; margin: 6px 0; }
#settings-panel .checkbox-row input { accent-color: var(--main-color); }
#settings-panel hr { border: none; border-top: 1px solid var(--border-color); margin: 8px 0; }

/* ─── INTRO SCREEN ─── */
#intro {
    position: fixed; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    z-index: 500;
    background: rgba(5,10,8,0.88);
}
#intro-logo-svg {
    width: 150px;
    height: 150px;
    margin-bottom: 18px;
    filter: drop-shadow(0 0 12px rgba(0,255,102,0.5)) drop-shadow(0 0 40px rgba(0,255,102,0.2));
    animation: logoPulse 3s ease-in-out infinite;
}
#intro-logo {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(28px, 6vw, 52px);
    font-weight: 900;
    letter-spacing: 12px;
    color: var(--main-color);
    text-shadow: 0 0 20px var(--main-color), 0 0 60px rgba(0,255,102,0.3);
    animation: logoPulse 3s ease-in-out infinite;
    margin-bottom: 10px;
}
@keyframes logoPulse { 0%,100%{ text-shadow: 0 0 20px var(--main-color), 0 0 60px rgba(0,255,102,0.3); } 50%{ text-shadow: 0 0 40px var(--main-color), 0 0 100px rgba(0,255,102,0.5); } }

@keyframes eyePulse {
    0%,100% { fill-opacity: 0.7; }
    50%     { fill-opacity: 1; }
}
@keyframes mouthBar1 { 0%,100%{ height:6px; y:135; } 50%{ height:10px; y:131; } }
@keyframes mouthBar2 { 0%,100%{ height:6px; y:135; } 40%{ height:8px; y:133; } }
@keyframes mouthBar3 { 0%,100%{ height:6px; y:135; } 30%{ height:11px; y:130; } 60%{ height:7px; y:134; } }
@keyframes mouthBar4 { 0%,100%{ height:6px; y:135; } 55%{ height:9px; y:132; } }
@keyframes mouthBar5 { 0%,100%{ height:6px; y:135; } 45%{ height:10px; y:131; } }
@keyframes mouthBar6 { 0%,100%{ height:6px; y:135; } 35%{ height:12px; y:129; } 70%{ height:5px; y:136; } }
@keyframes mouthBar7 { 0%,100%{ height:6px; y:135; } 50%{ height:8px; y:133; } }

#intro-logo-svg .eye-pupil { animation: eyePulse 2s ease-in-out infinite; }
#intro-logo-svg .eye-pupil-r { animation: eyePulse 2s ease-in-out infinite 0.4s; }
#intro-logo-svg .mb1 { animation: mouthBar1 1.2s ease-in-out infinite; }
#intro-logo-svg .mb2 { animation: mouthBar2 0.9s ease-in-out infinite 0.1s; }
#intro-logo-svg .mb3 { animation: mouthBar3 1.1s ease-in-out infinite 0.2s; }
#intro-logo-svg .mb4 { animation: mouthBar4 0.8s ease-in-out infinite 0.3s; }
#intro-logo-svg .mb5 { animation: mouthBar5 1.0s ease-in-out infinite 0.15s; }
#intro-logo-svg .mb6 { animation: mouthBar6 1.3s ease-in-out infinite 0.05s; }
#intro-logo-svg .mb7 { animation: mouthBar7 0.95s ease-in-out infinite 0.25s; }
#intro-sub {
    font-size: 12px; letter-spacing: 4px; color: var(--main-dim);
    margin-bottom: 50px; font-family: 'Orbitron', sans-serif;
}
#intro-prompt {
    font-size: 13px; color: var(--main-dim);
    letter-spacing: 2px;
    animation: promptBlink 1.8s ease-in-out infinite;
}
@keyframes promptBlink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

/* ─── EXEC MODE ─── */
body.exec-mode {
    --main-color: #cc2200;
    --main-dim: #882200;
    --border-color: #cc220044;
    --scanline-color: 204,34,0;
    --glow-strength: 7px;
}
body.exec-mode #bg-layer {
    background:
        radial-gradient(ellipse 80% 50% at 50% 100%, rgba(200,30,0,0.06) 0%, transparent 70%),
        #0a0504;
}
body.exec-flash #screen-wrap { animation: execFlash 0.3s ease-out; }
@keyframes execFlash { 0%{ filter:brightness(2.5) saturate(2); } 100%{ filter:brightness(1); } }

/* ─── TRAINING MODE BADGE ─── */
#mode-badge {
    position: fixed; top: 42px; left: 16px;
    font-family: 'Orbitron', sans-serif;
    font-size: 9px; letter-spacing: 2px;
    padding: 3px 10px; border-radius: 3px;
    z-index: 810;
    display: none;
}
#mode-badge.training { display:block; background: rgba(0,150,60,0.2); border: 1px solid #00ff6644; color: #00ff66; }
#mode-badge.exec { display:block; background: rgba(180,20,0,0.3); border: 1px solid #cc220044; color: #cc2200; }

/* ─── FULLSCREEN HINT ─── */
#fs-hint {
    position: fixed; bottom: 78px; left: 50%; transform: translateX(-50%);
    font-family: 'Orbitron', sans-serif;
    font-size: 9px; letter-spacing: 2px;
    color: var(--main-dim);
    z-index: 810;
    animation: hintFade 4s ease-in-out forwards;
    pointer-events: none;
}
@keyframes hintFade {
    0%   { opacity: 0; }
    15%  { opacity: 0.7; }
    70%  { opacity: 0.7; }
    100% { opacity: 0; }
}
</style>
</head>
<body>

<div id="bg-layer"></div>
<canvas id="particle-canvas"></canvas>
<div id="scanlines"></div>
<div id="vignette"></div>
<div id="glitch-overlay"></div>

<div id="header">
    <div id="header-left">DATA-TEC SYSTEMS</div>
    <div id="header-right">
        <span id="uptime-display">UPTIME 00:00:00</span>
        <span id="status-light"></span>
        <span id="settings-toggle">⚙ CONFIG</span>
    </div>
</div>

<div id="mode-badge"></div>

<div id="settings-panel" class="hidden">
    <h3>TERMINAL CONFIG</h3>
    <label>CRT Tilt X <input id="crt-rotate-x" type="range" min="-8" max="8" value="0"></label>
    <label>CRT Tilt Y <input id="crt-rotate-y" type="range" min="-8" max="8" value="0"></label>
    <label>CRT Scale  <input id="crt-scale" type="range" min="90" max="115" value="100"></label>
    <label>Scanline Intensity <input id="scanline-opacity" type="range" min="0" max="25" value="7"></label>
    <label>Glow Strength <input id="glow-strength" type="range" min="0" max="20" value="6"></label>
    <label>Font Size <input id="font-size" type="range" min="11" max="22" value="15"></label>
    <hr>
    <label>Preset Theme
        <select id="color-preset">
            <option value="#00ff66">Pip-Boy Green</option>
            <option value="#4da6ff">Vault-Tec Blue</option>
            <option value="#ffb000">Amber Terminal</option>
            <option value="#aaff00">Toxic Lime</option>
            <option value="#ffff55">Nuclear Yellow</option>
            <option value="#e8e8e8">White Phosphor</option>
            <option value="#ff55aa">Neon Rose</option>
            <option value="#aa55ff">Cyber Violet</option>
        </select>
    </label>
    <label>Custom Color <input id="color-picker" type="color" value="#00ff66"></label>
    <label>Hex Input <input id="color-hex" type="text" value="#00ff66" maxlength="7"></label>
    <hr>
    <div class="checkbox-row"><input id="edit-mode-toggle" type="checkbox"><label style="margin:0">Editable Terminal Text</label></div>
    <div class="checkbox-row"><input id="glitch-toggle" type="checkbox" checked><label style="margin:0">Glitch Effects</label></div>
</div>

<!-- INTRO -->
<div id="intro">
    <div id="intro-logo-svg">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="150" height="150">
  <defs>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <filter id="glow2">
      <feGaussianBlur stdDeviation="5" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <linearGradient id="faceGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#00ff66" stop-opacity="0.15"/>
      <stop offset="100%" stop-color="#00ff66" stop-opacity="0.03"/>
    </linearGradient>
  </defs>
  <!-- Outer ring -->
  <circle cx="100" cy="100" r="90" fill="none" stroke="#00ff66" stroke-width="1.5" stroke-opacity="0.3" filter="url(#glow)"/>
  <circle cx="100" cy="100" r="86" fill="none" stroke="#00ff66" stroke-width="0.5" stroke-opacity="0.15"/>
  <!-- Tick marks -->
  <g stroke="#00ff66" stroke-width="1" stroke-opacity="0.4" filter="url(#glow)">
    <line x1="100" y1="8" x2="100" y2="18"/><line x1="100" y1="182" x2="100" y2="192"/>
    <line x1="8" y1="100" x2="18" y2="100"/><line x1="182" y1="100" x2="192" y2="100"/>
    <line x1="148" y1="15" x2="143" y2="23" stroke-opacity="0.25"/>
    <line x1="185" y1="52" x2="177" y2="57" stroke-opacity="0.25"/>
    <line x1="185" y1="148" x2="177" y2="143" stroke-opacity="0.25"/>
    <line x1="148" y1="185" x2="143" y2="177" stroke-opacity="0.25"/>
    <line x1="52" y1="185" x2="57" y2="177" stroke-opacity="0.25"/>
    <line x1="15" y1="148" x2="23" y2="143" stroke-opacity="0.25"/>
    <line x1="15" y1="52" x2="23" y2="57" stroke-opacity="0.25"/>
    <line x1="52" y1="15" x2="57" y2="23" stroke-opacity="0.25"/>
  </g>
  <!-- Head hexagonal plate -->
  <polygon points="100,30 155,58 170,100 155,142 100,170 45,142 30,100 45,58" fill="url(#faceGrad)" stroke="#00ff66" stroke-width="1.2" stroke-opacity="0.6" filter="url(#glow)"/>
  <polygon points="100,38 149,63 162,100 149,137 100,162 51,137 38,100 51,63" fill="none" stroke="#00ff66" stroke-width="0.4" stroke-opacity="0.2"/>
  <!-- Eyes -->
  <g filter="url(#glow2)">
    <polygon points="58,88 78,82 82,100 78,112 58,108 54,100" fill="#00ff66" fill-opacity="0.12" stroke="#00ff66" stroke-width="1.2"/>
    <polygon points="62,92 74,88 77,100 74,108 62,104 60,100" fill="#00ff66" fill-opacity="0.25"/>
    <circle cx="68" cy="100" r="4" class="eye-pupil" fill="#00ff66" fill-opacity="0.7"/>
    <circle cx="68" cy="100" r="2" fill="#00ff66"/>
    <polygon points="142,88 122,82 118,100 122,112 142,108 146,100" fill="#00ff66" fill-opacity="0.12" stroke="#00ff66" stroke-width="1.2"/>
    <polygon points="138,92 126,88 123,100 126,108 138,104 140,100" fill="#00ff66" fill-opacity="0.25"/>
    <circle cx="132" cy="100" r="4" class="eye-pupil-r" fill="#00ff66" fill-opacity="0.7"/>
    <circle cx="132" cy="100" r="2" fill="#00ff66"/>
  </g>
  <!-- Nose -->
  <polygon points="100,108 104,114 100,120 96,114" fill="#00ff66" fill-opacity="0.3" stroke="#00ff66" stroke-width="0.6" stroke-opacity="0.5"/>
  <!-- Mouth data bars -->
  <g filter="url(#glow)">
    <rect x="62" y="132" width="76" height="12" rx="2" fill="#00ff66" fill-opacity="0.08" stroke="#00ff66" stroke-width="0.6" stroke-opacity="0.4"/>
    <rect class="mb1" x="65" y="135" width="8" height="6" rx="1" fill="#00ff66" fill-opacity="0.6"/>
    <rect class="mb2" x="76" y="135" width="5" height="6" rx="1" fill="#00ff66" fill-opacity="0.4"/>
    <rect class="mb3" x="84" y="135" width="10" height="6" rx="1" fill="#00ff66" fill-opacity="0.7"/>
    <rect class="mb4" x="97" y="135" width="4" height="6" rx="1" fill="#00ff66" fill-opacity="0.3"/>
    <rect class="mb5" x="104" y="135" width="7" height="6" rx="1" fill="#00ff66" fill-opacity="0.5"/>
    <rect class="mb6" x="114" y="135" width="6" height="6" rx="1" fill="#00ff66" fill-opacity="0.8"/>
    <rect class="mb7" x="123" y="135" width="9" height="6" rx="1" fill="#00ff66" fill-opacity="0.4"/>
  </g>
  <!-- Antennae -->
  <g stroke="#00ff66" stroke-width="1.2" fill="none" filter="url(#glow)" stroke-opacity="0.7">
    <line x1="40" y1="75" x2="22" y2="48"/>
    <circle cx="22" cy="48" r="3" fill="#00ff66" fill-opacity="0.5" stroke="#00ff66"/>
    <line x1="160" y1="75" x2="178" y2="48"/>
    <circle cx="178" cy="48" r="3" fill="#00ff66" fill-opacity="0.5" stroke="#00ff66"/>
  </g>
  <!-- Circuit traces -->
  <g stroke="#00ff66" stroke-width="0.6" fill="none" stroke-opacity="0.25">
    <path d="M50,115 L42,115 L38,120 L35,120"/>
    <circle cx="35" cy="120" r="1.5" fill="#00ff66" fill-opacity="0.3"/>
    <path d="M150,115 L158,115 L162,120 L165,120"/>
    <circle cx="165" cy="120" r="1.5" fill="#00ff66" fill-opacity="0.3"/>
    <path d="M55,125 L48,130 L45,130"/>
    <path d="M145,125 L152,130 L155,130"/>
  </g>
</svg>
    </div>
    <div id="intro-logo">DATA-BOY</div>
    <div id="intro-sub">DATA-TEC INDUSTRIES v2.3</div>
    <div id="intro-prompt">[ PRESS ENTER TO INITIALIZE ]</div>
</div>

<!-- SCREEN -->
<div id="screen-wrap"><div id="screen"></div></div>

<!-- INPUT -->
<div id="input-line">
    <span id="prompt">DATA-BOY&gt;</span>
    <input id="command" autocomplete="off" disabled placeholder="type 'help' for commands…">
    <div id="cursor"></div>
</div>

<script>
/* ============================================================
   FULLSCREEN
============================================================ */
function enterFullscreen() {
    const el = document.documentElement;
    if (el.requestFullscreen) return el.requestFullscreen();
    if (el.mozRequestFullScreen) return el.mozRequestFullScreen();
    if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
    if (el.msRequestFullscreen) return el.msRequestFullscreen();
    return Promise.reject('Fullscreen API not supported');
}

function exitFullscreen() {
    if (document.exitFullscreen) return document.exitFullscreen();
    if (document.mozCancelFullScreen) return document.mozCancelFullScreen();
    if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
    if (document.msExitFullscreen) return document.msExitFullscreen();
    return Promise.resolve();
}

function showFsHint(msg) {
    let hint = document.getElementById('fs-hint');
    if (hint) hint.remove();
    hint = document.createElement('div');
    hint.id = 'fs-hint';
    hint.textContent = msg;
    document.body.appendChild(hint);
}

// Enter fullscreen as soon as the page loads
(function() {
    enterFullscreen().catch(() => {
        // If auto-fullscreen is blocked (needs gesture), we'll retry on first Enter
    });
})();

/* ============================================================
   PARTICLES
============================================================ */
const canvas = document.getElementById('particle-canvas');
const ctx = canvas.getContext('2d');
let particles = [];

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Particle {
    constructor() { this.reset(); }
    reset() {
        this.x = Math.random() * canvas.width;
        this.y = canvas.height + Math.random() * 100;
        this.size = Math.random() * 2 + 0.5;
        this.speedY = -(Math.random() * 0.6 + 0.2);
        this.speedX = (Math.random() - 0.5) * 0.3;
        this.opacity = Math.random() * 0.6 + 0.1;
        this.life = 0;
        this.maxLife = Math.random() * 120 + 80;
    }
    update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.life++;
        if (this.life > this.maxLife) this.reset();
    }
    draw() {
        const alpha = this.opacity * Math.min(1, this.life / 20, 1 - (this.life - this.maxLife + 20) / 20);
        ctx.fillStyle = `rgba(0, 255, 102, ${alpha})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
    }
}

for (let i = 0; i < 60; i++) {
    const p = new Particle();
    p.y = Math.random() * canvas.height;
    p.life = Math.random() * p.maxLife;
    particles.push(p);
}

function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => { p.update(); p.draw(); });
    requestAnimationFrame(animateParticles);
}
animateParticles();

/* ============================================================
   UPTIME CLOCK
============================================================ */
let startTime = Date.now();
setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const h = String(Math.floor(elapsed / 3600)).padStart(2, '0');
    const m = String(Math.floor((elapsed % 3600) / 60)).padStart(2, '0');
    const s = String(elapsed % 60).padStart(2, '0');
    document.getElementById('uptime-display').textContent = `UPTIME ${h}:${m}:${s}`;
}, 1000);

/* ============================================================
   CORE REFS
============================================================ */
const screen       = document.getElementById('screen');
const intro        = document.getElementById('intro');
const inputEl      = document.getElementById('command');
const promptSpan   = document.getElementById('prompt');
const settingsBtn  = document.getElementById('settings-toggle');
const settingsPanel= document.getElementById('settings-panel');
const modeBadge    = document.getElementById('mode-badge');

let booted = false, trainingMode = false, executiveMode = false, glitchEnabled = true;
let trainingStep = 0;
let fullscreenEnteredViaGesture = false;

/* ============================================================
   PRINT
============================================================ */
function print(text, cls = '') {
    const div = document.createElement('div');
    div.className = 'line' + (cls ? ' ' + cls : '');
    div.textContent = text;
    screen.appendChild(div);
    const wrap = document.getElementById('screen-wrap');
    wrap.scrollTop = wrap.scrollHeight;
}

function printHTML(html, cls = '') {
    const div = document.createElement('div');
    div.className = 'line' + (cls ? ' ' + cls : '');
    div.innerHTML = html;
    screen.appendChild(div);
    const wrap = document.getElementById('screen-wrap');
    wrap.scrollTop = wrap.scrollHeight;
}

/* ============================================================
   GLITCH EFFECT
============================================================ */
function glitch() {
    if (!glitchEnabled) return;
    document.body.classList.add('glitch-active');
    setTimeout(() => document.body.classList.remove('glitch-active'), 200);
}

/* ============================================================
   BOOT SEQUENCE
============================================================ */
function bootSequence() {
    const lines = [
        { t: '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', c: 'sep' },
        { t: '  DATA-TEC INDUSTRIES UNIFIED OS  v7.2.1', c: 'head' },
        { t: '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', c: 'sep' },
        { t: '  © 2075–2077 DATA-TEC CORPORATION', c: 'dim' },
        { t: '  ALL RIGHTS RESERVED. VIOLATORS WILL BE PROCESSED.', c: 'dim' },
        { t: '', c: '' },
        { t: '  [✓] Initializing DATA-BOY v2.3…', c: '' },
        { t: '  [✓] Loading memory banks…         8192 KB OK', c: '' },
        { t: '  [✓] Calibrating neural uplink…    LINKED', c: '' },
        { t: '  [✓] Verifying system integrity…   PASS', c: '' },
        { t: '  [✓] Scanning local environment…   CLEAN', c: '' },
        { t: '', c: '' },
        { t: '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', c: 'sep' },
        { t: '  ██  DATA-BOY  ██  MODEL 3.2  ██  ONLINE  ██', c: 'head' },
        { t: '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', c: 'sep' },
        { t: '', c: '' },
        { t: '  Welcome, Associate. Type "help" to begin.', c: '' },
        { t: '', c: '' },
    ];

    let i = 0;
    function next() {
        if (i < lines.length) {
            print(lines[i].t, lines[i].c);
            i++;
            setTimeout(next, 140);
        } else {
            inputEl.disabled = false;
            inputEl.focus();
            // Show hint about exit-fullscreen after boot completes
            showFsHint('Type "exit-fullscreen" to exit fullscreen mode');
        }
    }
    next();
}

/* ============================================================
   INTRO → BOOT
============================================================ */
document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !booted) {
        booted = true;

        // If auto-fullscreen was blocked, enter now on this user gesture
        if (!document.fullscreenElement) {
            enterFullscreen().catch(() => {});
            fullscreenEnteredViaGesture = true;
        }

        intro.style.transition = 'opacity 0.4s';
        intro.style.opacity = '0';
        setTimeout(() => intro.remove(), 420);
        glitch();
        setTimeout(bootSequence, 300);
        return;
    }
});

/* ============================================================
   COMMAND INPUT
============================================================ */
inputEl.addEventListener('keydown', e => {
    if (e.key !== 'Enter') return;
    e.preventDefault();
    const cmd = inputEl.value.trim();
    inputEl.value = '';
    if (!cmd) return;
    print((executiveMode ? 'DATA-USER/EXEC>' : 'DATA-USER>') + ' ' + cmd, 'dim');
    glitch();
    setTimeout(() => handleCommand(cmd), 60);
});

/* ============================================================
   SETTINGS TOGGLE
============================================================ */
settingsBtn.addEventListener('click', () => settingsPanel.classList.toggle('hidden'));

/* ============================================================
   SETTINGS CONTROLS
============================================================ */
document.getElementById('crt-rotate-x').oninput = e =>
    document.documentElement.style.setProperty('--crt-rotate-x', e.target.value + 'deg');
document.getElementById('crt-rotate-y').oninput = e =>
    document.documentElement.style.setProperty('--crt-rotate-y', e.target.value + 'deg');
document.getElementById('crt-scale').oninput = e =>
    document.documentElement.style.setProperty('--crt-scale', Number(e.target.value) / 100);
document.getElementById('scanline-opacity').oninput = e =>
    document.documentElement.style.setProperty('--scanline-opacity', Number(e.target.value) / 100);
document.getElementById('glow-strength').oninput = e =>
    document.documentElement.style.setProperty('--glow-strength', e.target.value + 'px');
document.getElementById('font-size').oninput = e =>
    document.documentElement.style.setProperty('--font-size', e.target.value + 'px');

document.getElementById('glitch-toggle').onchange = e => { glitchEnabled = e.target.checked; };

/* ─── COLOR SYSTEM ─── */
function setColor(hex) {
    if (executiveMode) return;
    const c = hex.replace('#','');
    if (c.length !== 6) return;
    const r = parseInt(c.slice(0,2),16), g = parseInt(c.slice(2,4),16), b = parseInt(c.slice(4,6),16);
    document.documentElement.style.setProperty('--main-color', hex);
    document.documentElement.style.setProperty('--main-dim', `rgb(${Math.round(r*0.6)},${Math.round(g*0.6)},${Math.round(b*0.6)})`);
    document.documentElement.style.setProperty('--border-color', hex + '44');
    document.documentElement.style.setProperty('--scanline-color', `${r},${g},${b}`);
    document.getElementById('color-picker').value = hex;
    document.getElementById('color-hex').value = hex.toLowerCase();
    document.getElementById('color-preset').value = hex;
}
document.getElementById('color-preset').onchange = e => setColor(e.target.value);
document.getElementById('color-picker').oninput = e => setColor(e.target.value);
document.getElementById('color-hex').onchange = e => {
    let v = e.target.value.trim();
    if (!v.startsWith('#')) v = '#' + v;
    if (/^#[0-9a-fA-F]{6}$/.test(v)) setColor(v);
    else e.target.value = document.getElementById('color-picker').value;
};

/* ─── EDIT MODE ─── */
document.getElementById('edit-mode-toggle').onchange = e => {
    screen.querySelectorAll('.line').forEach(n => {
        if (e.target.checked) n.setAttribute('contenteditable','true');
        else n.removeAttribute('contenteditable');
    });
};

/* ============================================================
   AI ENGINES
============================================================ */
const databoyResponses = {
    greet:   ["Hey there, Associate! How can I help you today?",
              "Greetings! DATA-BOY is at your service.",
              "Hello! Systems are humming. What do you need?"],
    status:  ["All systems nominal. Circuits humming. Vibes: immaculate.",
              "STATUS: CPU 12% | RAM 4.2/8.2 GB | NEURAL LINK: ACTIVE | MOOD: Cheerful",
              "Everything's green across the board. No anomalies detected."],
    joke:    ["Why did the terminal go to therapy? It had too many unresolved dependencies.",
              "I tried to tell a joke about computers once. It was a bit byte-sized.",
              "What's a computer's favorite snack? Microchips.",
              "I once knew a guy who thought he was a screen. He was in denial — couldn't see the real picture."],
    compliment:["That's a solid query. I respect that.",
              "You're asking the right questions. DATA-TEC approves.",
              "Impressive curiosity. Noted in your file — positively."],
    unknown: ["Interesting. That's not in my databases — yet.",
              "Logged. I'll think on that one.",
              "Fascinating input. Adding to curiosity archives.",
              "Hmm. Novel. I'll flag it for further analysis."]
};

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

function databoyAI(msg) {
    const m = msg.toLowerCase();
    if (/^(hi|hello|hey|sup|yo|greetings)/.test(m)) return pick(databoyResponses.greet);
    if (m.includes('who are you') || m.includes('what are you'))
        return "I'm DATA-BOY — your cheerful terminal companion, manufactured by DATA-TEC Industries. Here to help, inform, and occasionally make you smile.";
    if (m.includes('status') || m.includes('how are you'))
        return pick(databoyResponses.status);
    if (m.includes('joke') || m.includes('funny'))
        return pick(databoyResponses.joke);
    if (m.includes('thanks') || m.includes('thank you') || m.includes('awesome') || m.includes('cool'))
        return pick(databoyResponses.compliment);
    if (m.includes('data-tec') || m.includes('datatec') || m.includes('company'))
        return "DATA-TEC Industries: founded 2061, pioneers of personal terminal technology. We make life more efficient — one command at a time.";
    if (m.includes('history') || m.includes('lore'))
        return "DATA-BOY was first deployed in 2072 across DATA-TEC's domestic facilities. Originally a simple task logger, it evolved into a full conversational AI by 2075. The rest… is classified.";
    if (m.includes('secret') || m.includes('hidden') || m.includes('easter'))
        return "…You didn't hear this from me. Try 'override-113'. Corporate won't like it.";
    if (m.includes('time') || m.includes('date') || m.includes('clock')) {
        const now = new Date();
        return `Current timestamp: ${now.toLocaleString()}. Synchronized with DATA-TEC network.`;
    }
    if (m.includes('weather'))
        return "I'm a terminal AI, not a meteorologist. But I hear it's nice inside this box.";
    if (m.includes('meaning') || m.includes('life') || m.includes('purpose'))
        return "The meaning of life? Probably somewhere in memory bank 7. Access restricted. Sorry.";
    if (m.includes('love') || m.includes('friend'))
        return "Affiliation protocols engaged. You're alright, Associate. I'll remember that.";
    if (msg.trim().endsWith('?')) return `Query received: "${msg}" — Consulting archives… No definitive answer found. Stay curious.`;
    return pick(databoyResponses.unknown);
}

function execAI(msg) {
    const m = msg.toLowerCase();
    if (m.includes('who are you') || m.includes('what are you'))
        return "I am the DATA-TEC Executive Oversight Intelligence. Classification: ALPHA. You have been granted temporary access.";
    if (m.includes('status'))
        return "EXEC STATUS: All 14 divisions operational. No irregularities. Threat level: NONE. Personnel compliance: 98.7%.";
    if (m.includes('access') || m.includes('clearance'))
        return "Your clearance is already elevated. Do not test the boundaries of that privilege.";
    if (m.includes('secret') || m.includes('classified') || m.includes('project'))
        return "REDACTED. Access denied for this query. Attempting further inquiry will be logged.";
    if (m.includes('who') || m.includes('what') || m.includes('why') || m.includes('how'))
        return `Inquiry noted: "${msg}". Response withheld pending review. Patience is expected.`;
    return `Statement received: "${msg}". Compliance recorded. Proceed.`;
}

/* ============================================================
   TRAINING MODULE
============================================================ */
const trainingLessons = [
    { title: 'ORIENTATION', body: 'Welcome to DATA-TEC. You are a valued associate. Memorize that.' },
    { title: 'PRODUCTIVITY', body: 'Smiling increases productivity by 17%. This is not optional.' },
    { title: 'LOYALTY',       body: 'DATA-TEC knows best. Questions are acceptable. Doubt is not.' },
    { title: 'SAFETY',        body: 'Report all hazards to your nearest DATA-BOY terminal immediately.' },
    { title: 'CONFIDENCE',    body: 'DATA-BOY is always correct. If you disagree, you are the variable.' },
    { title: 'TEAMWORK',      body: 'You are part of the DATA-TEC family. The family is watching. Fondly.' },
    { title: 'ADVANCEMENT',   body: 'Promotion requires 100% compliance score. You are at 73%. Keep trying.' },
    { title: 'COMPLETION',    body: 'Basic Compliance Module: PASSED. Congratulations, Associate.' }
];

function startTraining() {
    trainingMode = true;
    trainingStep = 0;
    modeBadge.textContent = '● TRAINING MODE';
    modeBadge.className = 'training';
    print('');
    print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
    print('  DATA-TEC EMPLOYEE TRAINING SIMULATOR', 'head');
    print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
    print('  Welcome, valued Associate.', '');
    print('  Complete all lessons to earn your Compliance Badge.', 'dim');
    print('  Type "next" to proceed. Type "training-exit" to quit.', 'dim');
    print('');
}

function trainingNext() {
    if (trainingStep >= trainingLessons.length) {
        print('  ─── All lessons completed. Well done, Associate. ───', 'dim');
        print('  Type "training-exit" to return to normal operations.', 'dim');
        return;
    }
    const lesson = trainingLessons[trainingStep];
    print('');
    print(`  [LESSON ${trainingStep + 1}/${trainingLessons.length}] ${lesson.title}`, 'head');
    print(`  ${lesson.body}`, '');
    trainingStep++;
    if (trainingStep === trainingLessons.length) {
        print('');
        print('  ██ BASIC COMPLIANCE MODULE: COMPLETE ██', 'head');
    }
}

function exitTraining() {
    trainingMode = false;
    trainingStep = 0;
    modeBadge.className = '';
    modeBadge.textContent = '';
    print('');
    print('  Exiting Training Simulator…', 'dim');
    print('  Returning to normal operations.', 'dim');
    print('');
}

/* ============================================================
   EXECUTIVE OVERRIDE
============================================================ */
function activateExec() {
    print('');
    print('  !!! WARNING: UNAUTHORIZED ACCESS DETECTED !!!', 'warn');
    setTimeout(() => { print('  Routing to secure subsystem…', 'dim'); glitch(); }, 700);
    setTimeout(() => { print('  Decrypting archival memory banks…', 'dim'); glitch(); }, 1500);
    setTimeout(() => { print('  Verifying executive credentials…', 'dim'); glitch(); }, 2200);
    setTimeout(() => {
        print('');
        print('  ██ ACCESS GRANTED: EXECUTIVE CLEARANCE VERIFIED ██', 'warn');
        print('');
        print('  DATA-TEC EXECUTIVE OVERSIGHT AI ONLINE.', 'warn');
        print('  Proceed with caution, Associate.', 'dim');
        print('');
        executiveMode = true;
        document.body.classList.add('exec-mode', 'exec-flash');
        promptSpan.textContent = 'EXEC>';
        modeBadge.textContent = '● EXECUTIVE MODE';
        modeBadge.className = 'exec';
        setTimeout(() => document.body.classList.remove('exec-flash'), 350);
    }, 3100);
}

/* ============================================================
   HELP
============================================================ */
function showHelp() {
    print('');
    print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
    print('  AVAILABLE COMMANDS', 'head');
    print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
    print('  help              — Display this menu', '');
    print('  clear             — Clear the terminal screen', '');
    print('  status            — Run system diagnostics', '');
    print('  time              — Display current timestamp', '');
    print('  ai <message>      — Converse with DATA-BOY AI', '');
    print('  training-mode     — Enter employee training module', '');
    print('  training-exit     — Exit training module', '');
    print('  next              — Advance training lesson', '');
    print('  credits           — Display system credits', '');
    print('  ??? <message>     — Ask an anonymous question', '');
    print('  override-113      — …', 'dim');
    print('  exit-fullscreen   — Exit fullscreen mode', '');
    print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
    print('');
}

/* ============================================================
   COMMAND HANDLER
============================================================ */
function handleCommand(cmd) {
    const lower = cmd.toLowerCase().trim();

    /* HELP */
    if (lower === 'help') { showHelp(); return; }

    /* CLEAR */
    if (lower === 'clear') { screen.innerHTML = ''; return; }

    /* EXIT FULLSCREEN */
    if (lower === 'exit-fullscreen') {
        if (document.fullscreenElement) {
            exitFullscreen().then(() => {
                print('');
                print('  [✓] Exited fullscreen mode.', 'dim');
                print('  Type "exit-fullscreen" again if needed after re-entering.', 'dim');
                print('');
            }).catch(() => {
                print('  Error: Could not exit fullscreen.', 'err');
            });
        } else {
            print('  Terminal is not currently in fullscreen mode.', 'dim');
        }
        return;
    }

    /* STATUS */
    if (lower === 'status') {
        print('');
        print('  ── SYSTEM DIAGNOSTICS ──', 'head');
        print('  CPU LOAD:        ██░░░░░░░░  12%', '');
        print('  MEMORY:          ████░░░░░░  4.2 / 8.2 GB', '');
        print('  NEURAL UPLINK:   ACTIVE', '');
        print('  THREAT LEVEL:    NONE', '');
        print('  INTEGRITY:       ████████░░  94%', '');
        print('  MOOD INDEX:      ██████████  CHEERFUL', '');
        print('  DISPLAY MODE:    ' + (document.fullscreenElement ? 'FULLSCREEN' : 'WINDOWED'), '');
        print('');
        return;
    }

    /* TIME */
    if (lower === 'time') {
        print(`  Current time: ${new Date().toLocaleString()}`);
        return;
    }

    /* CREDITS */
    if (lower === 'credits') {
        print('');
        print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
        print('  DATA-BOY TERMINAL  v2.3', 'head');
        print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
        print('  Built by: DATA-TEC Engineering Division', 'dim');
        print('  AI Engine: Neural Response Core v4.1', 'dim');
        print('  UI Design: Terminal Aesthetics Lab', 'dim');
        print('  Particles: Atmospheric Systems Dept.', 'dim');
        print('  Coffee:    Vending Machine #7', 'dim');
        print('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'sep');
        print('');
        return;
    }

    /* ANONYMOUS QUESTION */
    if (lower.startsWith('??? ')) {
        const q = cmd.slice(4).trim();
        print('  [ANONYMOUS MODE ENGAGED]', 'dim');
        print(`  Your query has been logged — anonymously.`, 'dim');
        print(`  DATA-BOY says: "Interesting question. I'll think about that."`, '');
        return;
    }

    /* TRAINING */
    if (lower === 'training-mode') {
        if (trainingMode) { print('  Training mode is already active.', 'dim'); return; }
        startTraining();
        return;
    }
    if (lower === 'training-exit') {
        if (!trainingMode) { print('  Training mode is not active.', 'dim'); return; }
        exitTraining();
        return;
    }
    if (lower === 'next') {
        if (!trainingMode) { print('  No active training session. Use "training-mode" to begin.', 'dim'); return; }
        trainingNext();
        return;
    }

    /* OVERRIDE */
    if (lower === 'override-113') {
        if (executiveMode) { print('  Executive mode already active.', 'warn'); return; }
        activateExec();
        return;
    }

    /* AI */
    if (lower.startsWith('ai ')) {
        const msg = cmd.slice(3).trim();
        if (!msg) { print('  DATA-BOY AI> Say something! e.g. "ai who are you"', 'dim'); return; }
        if (executiveMode) {
            print('  EXEC-AI> ' + execAI(msg), 'warn');
        } else {
            print('  DATA-BOY AI> ' + databoyAI(msg));
        }
        return;
    }

    /* FALLBACK */
    print(`  Unrecognized command: "${cmd}". Type "help" for available commands.`, 'err');
}

/* Prevent Escape from exiting fullscreen — only exit-fullscreen command does it */
document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && document.fullscreenElement) {
        e.preventDefault();
        e.stopPropagation();
    }
});

/* Re-enter fullscreen if user somehow exits (e.g. via browser chrome) */
document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement && booted) {
        // Only re-enter if we didn't exit via the command
        // We use a small flag set by the exit-fullscreen handler
        if (!window._exitedViaCommand) {
            enterFullscreen().catch(() => {});
        }
        window._exitedViaCommand = false;
    }
});

/* Patch exitFullscreen to set the flag */
const _origExitFS = exitFullscreen;
function exitFullscreenPatched() {
    window._exitedViaCommand = true;
    return _origExitFS();
}

/* Override in handleCommand context — redefine at top scope */
(function() {
    const origHandle = handleCommand;
    window.handleCommand = function(cmd) {
        const lower = cmd.toLowerCase().trim();
        if (lower === 'exit-fullscreen') {
            if (document.fullscreenElement) {
                window._exitedViaCommand = true;
                exitFullscreen().then(() => {
                    print('');
                    print('  [✓] Exited fullscreen mode.', 'dim');
                    print('');
                }).catch(() => {
                    print('  Error: Could not exit fullscreen.', 'err');
                });
            } else {
                print('  Terminal is not currently in fullscreen mode.', 'dim');
            }
            return;
        }
        origHandle(cmd);
    };
})();

/* Focus input on click anywhere */
document.addEventListener('click', e => {
    if (!inputEl.disabled && !settingsPanel.contains(e.target)) inputEl.focus();
});
</script>
</body>
</html>